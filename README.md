# eh_classify_with_ETTDB 简介
使用硬链接，根据作者和团队名整理漫画文件。

## 主要功能
根据文件名匹配作者或团队名，利用[EhTagTranslation](https://github.com/EhTagTranslation/Database)项目中的数据准确区分作者和团队名，使用硬链接对文件分类整理，以达到不破坏原本的目录结构分类的目的。

优点：

* 使用硬链接，不用担心数据错乱，不会改动原有文件，恢复方便
* 硬链接可以做到多种分类共存而不额外占用空间
* 利用[EhTagTranslation](https://github.com/EhTagTranslation/Database)数据库，准确区分作者和团队，防止命名混乱
* 
缺点:

* 硬链接无法跨分区使用
* 只能对已初步整理的文件分类，详见使用说明
* 追求完全匹配数据库，如果作者/团队名中有或少空格就无法识别，需要手动处理
* 代码ai写的，不保证稳定性

## 使用说明
需要：python3

### 可识别格式
匹配第一对"[]"，且只匹配文件，防止对文件夹造成不可逆操作，"[]"内如果有"()"会先当作团队名，最后整理会以数据库为准；

    ....[作者名(团队名)].....
### 主要功能
在命令行中执行如下命令运行脚本（linux自行替换反斜杠，未测试不保证能用）：

    python3 <脚本所在路径\eh_classify.py> <漫画文件所在目录> [整理后要放到的目录]
脚本接收的两个参数都需要是目录，[整理后要放到的目录]可选，如果不填，默认和前一个目录相同。
脚本运行成功后，应该能在[整理后要放到的目录]下看到3个文件夹：
[整理后要放到的目录]\unsort：整理失败、未在数据库中匹配到作者/团队名的文件都放在这；
[整理后要放到的目录]\artist：以作者名分类的文件
[整理后要放到的目录]\group：以团队名分类的文件
**注意：分类都是根据罗马音来的，非罗马音的作者/团队名如果能匹配上，会放到对应的罗马音分类里**

### 其它功能
查看帮助，直接运行脚本或：

    python3 <脚本所在路径\eh_classify.py> help
如果要更新数据库，可以在[EhTagTranslation](https://github.com/EhTagTranslation/Database)下载db.text.json覆盖脚本目录下的同名文件，然后运行如下命令：

    python3 <脚本所在路径\eh_classify.py> newdb
简单的数据查找功能：可以查找数据中是否有目标作者/团队，有些数据是没翻译的

    python3 <脚本所在路径\eh_classify.py> -s keyword
### 脚本运行流程
1. 获取参数并判断运行模式，如果参数格式正确（目录中有任意文件，文件夹除外），则会读取目录下的数据库文件；
2. 数据库文件使用[EhTagTranslation](https://github.com/EhTagTranslation/Database)项目的db.text.json，脚本会根据它创建一个db.lists.json，如果没有这个文件会自动创建，也可以使用上面的命令手动创建；
3. 脚本会遍历目录下的文件列表，根据第一个中括号匹配作者名，根据圆括号匹配团队名，作者名匹配成功就会去数据库查找；
4. 每次查找都会遍历数据库，查找时不分作者名或团队名，因为[作者(团队)]和[作者(团队)]格式的文件名都可能存在，但比如在团队数据库查找成功，那么这次就不会再在团队数据库中进行查找，查找到的结果都会以罗马音的格式为准；
5. 第4步中如果没找到对应的数据，那么会放到unsort文件夹中，不会根据文件名匹配结果进行分类。
